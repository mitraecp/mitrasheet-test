import{f as T,r as f,H as b,v as $,o as r,b as d,u as n,c as C,w as D,l as R,aE as q,ax as M,e as w,k as N,M as E,C as P,J as v,t as U,ag as G,ar as J,aH as K,s as Q,x as W,a as X}from"./entry.102678be.js";import{_ as Y}from"./CollaboratorAvatar.vue.dd08577c.js";import{a as Z}from"./useLegacyService.c9b3bbf8.js";import{a as ee}from"./index.d52a6416.js";/* empty css                           */import"./index.3105222b.js";const te={class:"w-full"},ne=["data-cy","onClick"],ae={class:"ml-3 truncate font-[400] text-[16px] h-[17px]"},se={class:"link-record-wrapper h-full flex items-center min-h-[20px] w-full px-2","data-cy":"link-record-area"},oe=["title"],ie=T({__name:"TableLinkRecord",props:{content:{type:[Array,Object],default:()=>[]},header:{type:Object,default:()=>({})},displayPicture:{type:Boolean,default:!1},saving:{type:Boolean,default:!1},readonlyCell:{type:Boolean,default:!1}},emits:["set-data-entry"],setup(u,{emit:z}){const o=u,O=Z(),A=f(null),p=f(!1),y=f(!1),h=f(""),x=b(()=>{var t;return(t=[o.header.referencedDimensionId,o.header.dimensionId].includes(K.USER))!=null?t:!1}),m=f([]),_=b(()=>o.content?Array.isArray(o.content)?o.content:[o.content]:[]),j=b(()=>m.value.filter(t=>t.name&&t.name.toLowerCase().includes(h.value.toLowerCase())).slice(0,1e3));ee(A,()=>B(),{distance:15});async function F(){y.value=!0;try{m.value=[],await B(),I(!0)}catch{Q("Falha ao carregar membros dessa dimens\xE3o!")}y.value=!1}async function B(){var a;const t=(a=o.header.referencedDimensionId||o.header.dimensionId||o.header.id.id)!=null?a:0;if(t){const{dimensionDataView:s}=await O.getDimensionContent(t,{query:{limit:100,offSet:m.value.length}});m.value=[...m.value,...s.contents.map(i=>({id:i.internalId,name:x.value?i.dimensionContentAttributesView[1]:i.dimensionContentAttributesView[0],picture:x.value?i.dimensionContentAttributesView[2]:""}))]}}function I(t){p.value=t}function H(t){var g,e;const a=(e=(g=o.header.dimensionAttributeType)==null?void 0:g.includes("Single"))!=null?e:!0;let s=[..._.value];const i=s.findIndex(c=>c.id===t.id);a?(i>-1?s=[null]:s=[t],I(!1)):i>-1?s.splice(i,1):s.push(t);const k=a?s[0]:s;z("set-data-entry",k)}return(t,a)=>{const s=W,i=$("a-input"),k=Y,g=$("a-popover");return r(),d("div",te,[n(p)?(r(),C(g,{key:0,visible:n(p),"onUpdate:visible":a[1]||(a[1]=e=>M(p)?p.value=e:null),"overlay-class-name":"w-[220px] link",trigger:"click",placement:"bottomLeft","destroy-tooltip-on-hide":""},{content:D(()=>[R(i,{value:n(h),"onUpdate:value":a[0]||(a[0]=e=>M(h)?h.value=e:null),class:"h-[32px] pb-2",type:"text",placeholder:t.$t("GLOBAL.search")},{prefix:D(()=>[R(s,{size:"16",color:"grey",type:"mdi",path:n(q)},null,8,["path"])]),_:1},8,["value","placeholder"]),w("div",{ref_key:"linkRecordBox",ref:A,class:"mt-2 overflow-auto max-h-[170px] mx-[-14px]"},[(r(!0),d(N,null,E(n(j),e=>{var c;return r(),d("div",{key:`${e.id}`,class:P(["cursor-pointer hover:bg-[#eaecf0] h-[32px] m-1 rounded flex items-center px-[10px]",{active:n(_).find(l=>l.id===e.id)}]),"data-cy":`option-${e.id}`,onClick:l=>!u.saving&&H(e)},[n(x)?(r(),C(k,{key:0,src:e.picture,width:24,height:24},null,8,["src"])):v("",!0),w("span",ae,U((c=e.name)!=null?c:"unnamed record"),1),n(_).find(l=>l.id===e.id)?(r(),C(s,{key:1,size:"15px",type:"mdi",class:"ml-auto",color:"var(--violet-600)",path:n(G)},null,8,["path"])):v("",!0)],10,ne)}),128))],512)]),_:1},8,["visible"])):v("",!0),w("div",se,[(r(!0),d(N,null,E(n(_),(e,c)=>{var l,L,V,S;return r(),d("div",{key:c,class:"simple-tag"},[n(x)&&u.displayPicture?(r(),C(k,{key:0,src:e.picture,width:15,height:15,class:"ml-[4px]"},null,8,["src"])):v("",!0),w("span",{title:(L=(l=e.name)!=null?l:e.dimensionContentValue)!=null?L:"unnamed record"},U((S=(V=e.name)!=null?V:e.dimensionContentValue)!=null?S:"unnamed record"),9,oe)])}),128)),!u.header.isNative&&!u.readonlyCell?(r(),d("span",{key:0,class:P(["bg-[var(--violet-600)] text-white flex items-center px-1.5 rounded h-5 cursor-pointer add-button sticky right-[5px]",{"cursor-wait":n(y)}]),onClick:a[2]||(a[2]=J(e=>!n(y)&&F(),["stop"]))},"+",2)):v("",!0)])])}}}),me=X(ie,[["__scopeId","data-v-ddb4401d"]]);export{me as default};

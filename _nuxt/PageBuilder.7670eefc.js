import{f as te,al as oe,aY as ae,r as _,H as ne,v as q,o as v,b as D,N as V,O as S,u as a,l as i,e as n,C as F,k as le,M as ie,t as j,dh as se,ar as re,c as E,w as h,ax as N,J as $,ay as de,m as w,s as ue,x as me,d as pe,_ as ce}from"./entry.102678be.js";import _e from"./MetadataMenu.b0f082e3.js";import ve from"./DimensionTable.a32fdf85.js";import fe from"./DatasetTable.58a40157.js";import{_ as xe}from"./MButton.vue.eb72e6c7.js";/* empty css                    */import{u as be}from"./usePageBuilderService.b267b260.js";import{u as he}from"./dimension_store.1aca34b5.js";import{u as ye}from"./dataset_store.f318df7c.js";import"./BaseContentHeader.0262d7f9.js";import"./MitraIconButton.142ef623.js";import"./DatasetEditor.vue.7d311014.js";import"./useFormRules.a113b67d.js";import"./DimensionList.vue.eb7d2f91.js";import"./AccordionListMenu.10ceb037.js";import"./drag.f5ca2003.js";import"./useDataTypeIcons.d26d6eae.js";import"./useGoToScreen.2d5a4740.js";import"./legacy_store.afec42ea.js";import"./useLegacyService.c9b3bbf8.js";import"./useHeadSettings.f1985dcc.js";import"./composables.aec528df.js";import"./useURLPaths.92126496.js";import"./DatasetList.vue.42e42433.js";import"./TableAttributeContextMenu.c1ad8a44.js";/* empty css                           */import"./TableDynamicCell.vue.a471fd36.js";import"./TableCheckbox.vue.071e61a3.js";import"./TableDatePicker.vue.a1333c1a.js";import"./TableAutoComplete.d2339888.js";import"./index.3105222b.js";import"./TableLinkRecord.6de8f04c.js";import"./CollaboratorAvatar.vue.dd08577c.js";import"./index.d52a6416.js";import"./useAttributeTypes.0411c883.js";import"./DataEntry.class.85823036.js";import"./SmartSheet.02ade0c8.js";import"./TableAttributeMenu.3f27ab4e.js";import"./TableComponentsMenu.b916b5cb.js";import"./DatabaseSmartSheet.a9157bcb.js";import"./table_constants.06ca38ff.js";const we=""+new URL("double_square.35fa665c.svg",import.meta.url).href,ge=""+new URL("trash_outline.8f4fce14.svg",import.meta.url).href,Ce=pe(()=>ce(()=>import("./AutocompleteForm.904d9d2e.js"),["./AutocompleteForm.904d9d2e.js","./MButton.vue.eb72e6c7.js","./entry.102678be.js","./entry.b9c67788.css","./useFormRules.a113b67d.js","./MButton.c980c08b.css","./AutocompleteForm.33ceb12c.css"],import.meta.url).then(f=>f.default||f)),ke={class:"flex overflow-hidden h-full"},De={class:"flex p-2 pb-0 justify-between"},Ve={class:"ml-4 mt-2 font-bold"},Se={class:"flex"},Ee=n("img",{src:we},null,-1),Ne=n("span",{class:"ml-2"},"Editar",-1),$e=[Ee,Ne],Ie=n("img",{src:ge},null,-1),Ae=n("span",{class:"ml-3"},"Deletar",-1),Me=[Ie,Ae],Be=n("span",null,"Adicionar",-1),ze={class:"flex flex-col"},Le=n("br",null,null,-1),Re={class:"flex ml-auto"},Dt=te({__name:"PageBuilder",props:{screenId:{type:Number,required:!0},components:{type:Array,default:()=>[]},listLoading:{type:Boolean,default:!0}},emits:["create-component","update-component","delete-component"],setup(f,{emit:g}){const I=f,C=be(),O=he(),H=ye(),{preview:u}=oe(ae()),m=_(!1),p=_(!1),k=_(0),l=_(),s=_(!1),r=_(!1),J=ne(()=>[...O.dimensions.map(t=>({value:`${t.id}.dim`,label:t.name,type:t.isNative?"Dimens\xE3o Nativa":"Dimens\xE3o"})),...H.datasets.map(t=>({value:`${t.id}.data`,label:t.name,type:"Dataset"}))]);function Y(){var t,o,c;return l.value?(t=l.value)!=null&&t.datasetView?`${(o=l.value.datasetView)==null?void 0:o.id}.data`:`${(c=l.value)==null?void 0:c.dimensionView.id}.dim`:void 0}function G(){l.value=void 0,s.value=!0}function K(){s.value=!0,m.value=!1}function Q(){p.value=!0,m.value=!1}function W(t,o){l.value=t,k.value=o,m.value=!0}async function X(){var t;if(r.value=!0,(t=l.value)!=null&&t.id)try{await C.deleteScreenComponent(l.value.id)}catch{ue("Falha ao deletar componente")}r.value=!1,p.value=!1,g("delete-component",k.value)}async function Z(t){var y;const[o,c]=t.autocomplete.split("."),d=c==="data";if(r.value=!0,t.autocomplete)if((y=l.value)!=null&&y.id){const{component:x,error:b}=await C.putScreenComponent({id:l.value.id,screenId:I.screenId,name:t.name,dimensionId:d?null:Number(o),datasetId:d?Number(o):null});b||(g("update-component",{component:x,index:k.value}),s.value=!1)}else{const{component:x,error:b}=await C.postScreenComponent({screenId:I.screenId,name:t.name,dimensionId:d?null:Number(o),datasetId:d?Number(o):null});b||(g("create-component",x),s.value=!1)}r.value=!1}return(t,o)=>{var B;const c=_e,d=me,y=q("a-popover"),x=ve,b=fe,ee=Ce,A=q("a-modal"),M=xe;return v(),D("div",ke,[V(i(c,null,null,512),[[S,!a(u)]]),n("div",{class:F(["bg-grey-500 h-full w-full overflow-hidden flex flex-col",{"p-6":!a(u)}])},[n("div",{class:F(["bg-grey-200 overflow-y-auto h-full",{"rounded-xl":!a(u),"p-6":a(u)}])},[(v(!0),D(le,null,ie(f.components,(e,z)=>{var L,R,T,P;return v(),D("div",{key:`data-component-${e.id}`,class:"flex flex-col max-h-[500px] m-4 bg-white rounded-xl"},[n("div",De,[n("span",Ve,j(e.name),1),V(n("div",Se,[i(d,{class:"cursor-pointer",type:"mdi",path:a(se),onClick:re(U=>W(e,z),["stop"])},null,8,["path","onClick"]),((L=a(l))==null?void 0:L.id)===e.id?(v(),E(y,{key:0,visible:a(m),"onUpdate:visible":o[0]||(o[0]=U=>N(m)?m.value=U:null),"overlay-class-name":"w-[200px]","arrow-point-at-center":"",placement:"bottomRight",trigger:"click"},{content:h(()=>[n("div",{class:"select-tile",onClick:K},$e),n("div",{class:"select-tile",onClick:Q},Me)]),_:1},8,["visible"])):$("",!0)],512),[[S,!a(u)]])]),(R=e.dimensionView)!=null&&R.id?(v(),E(x,{key:`${e.id}-${(T=e.dimensionView)==null?void 0:T.id}`,dimension:e.dimensionView,"display-name":!1,"load-on-created":""},null,8,["dimension"])):$("",!0),e.datasetView?(v(),E(b,{key:`${e.id}-${(P=e.datasetView)==null?void 0:P.id}`,dataset:e.datasetView,"display-name":!1,"load-on-created":""},null,8,["dataset"])):$("",!0)])}),128)),V(n("div",{class:"flex justify-center items-center bg-white h-[50px] rounded-xl m-4 border-dashed border-2 cursor-pointer",onClick:G},[i(d,{type:"mdi",path:a(de)},null,8,["path"]),Be],512),[[S,!a(u)]])],2)],2),i(A,{visible:a(s),"onUpdate:visible":o[1]||(o[1]=e=>N(s)?s.value=e:null),title:(B=a(l))!=null&&B.id?"Editar tabela":"Adicionar tabela","destroy-on-close":"",footer:null},{default:h(()=>{var e;return[i(ee,{"auto-fill":"","text-input-required":!1,loading:a(r),"list-options":a(J),"initial-text-value":((e=a(l))==null?void 0:e.name)||"","autocomplete-value":Y(),onSave:Z},null,8,["loading","list-options","initial-text-value","autocomplete-value"])]}),_:1},8,["visible","title"]),i(A,{visible:a(p),"onUpdate:visible":o[3]||(o[3]=e=>N(p)?p.value=e:null),title:"Deletar tabela","destroy-on-close":"",footer:null},{default:h(()=>{var e;return[n("div",ze,[w(" Tem certeza que gostaria de deletar a tabela: "+j((e=a(l))==null?void 0:e.name)+" ?",1),Le,w(" Ap\xF3s realizar essa a\xE7\xE3o n\xE3o ser\xE1 possivel desfaze-la. "),n("div",Re,[i(M,{"data-cy":"btn-submit",class:"mt-4 mr-2 w-[100px] capitalize","html-type":"submit",white:"",onClick:o[2]||(o[2]=z=>!a(r)&&(p.value=!1))},{default:h(()=>[w("Cancelar ")]),_:1}),i(M,{"data-cy":"btn-submit",class:"mt-4 w-[100px] capitalize","html-type":"submit",loading:a(r),onClick:X},{default:h(()=>[w("Deletar ")]),_:1},8,["loading"])])])]}),_:1},8,["visible"])])}}});export{Dt as default};

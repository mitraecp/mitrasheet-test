import U from"./MetadataAddButton.41902bb4.js";import W from"./DroppableWrapper.e14af8ec.js";import{f as A,r as k,al as J,H as D,v as R,o as r,b as F,c as w,w as C,l as b,u as a,n as Z,A as q,e as E,t as $,ay as G,J as T,k as K,M as Q,dU as X,ar as Y,ax as ee,C as te,a7 as V,x as ne}from"./entry.102678be.js";import oe from"./MitraButton.1bc6f00c.js";import{_ as se}from"./MetadataButton.vue.350ca6ce.js";import ie from"./ViewFilterSelector.76e5ee38.js";import{u as ae}from"./useChartsSettings.971a22bb.js";import{u as re}from"./dimension_store.1aca34b5.js";const le={class:"flex flex-col container"},ue={key:1,class:"flex justify-between mb-2"},ce={class:"label-title"},me={key:0,class:"text-base text-grey-400 font-medium"},be=A({__name:"ViewFilter",props:{index:null,insetList:{type:Boolean}},emits:["submit"],setup(p,{emit:g}){const u=p,d=ae(),B=re(),n=k(),c=k(),{filterData:I}=J(d),f=k(!1),o=D(()=>I.value[u.index]),h=D(()=>u.insetList&&(!(o!=null&&o.value)||Object.keys(o.value).length===0));L();function L(){var e,l,s,v;const t=u.index==="viewFilter"?(e=d.viewForm.viewFilterForm)==null?void 0:e.filterItems:(v=(s=(l=d.viewForm.viewMeasureForm)==null?void 0:l[Number(u.index)].chips)==null?void 0:s[0].chipFilterForm)==null?void 0:v.filterItems;t==null||t.forEach(_=>{const x=B.dimensions.find(m=>_.dimensionId===m.id),y={};_.internalIds.forEach(m=>y[m]=!0),x&&S({dimension:x,list:y},!1)})}function S({list:t,dimension:e},l=!0){const s={...o.value};s[e.id]={list:t,dimension:e},n.value=!1,d.setFilterList(s,u.index),l&&g("submit",s)}function N(t){delete o.value[t],g("submit",o.value)}function M(t){n.value=!0,V(()=>{c.value.applyCache(),c.value.setData(t.dimension)})}const O=()=>{f.value=!0};function j(){f.value=!1}function z(t){f.value=!1;const e=JSON.parse(t.dataTransfer.getData("value")).data;e.dimensionId&&(n.value=!0,V(()=>{c.value.applyCache(),c.value.setData({id:e.dimensionId,name:e.alias})}))}return(t,e)=>{const l=U,s=W,v=ne,_=oe,x=se,y=ie,m=R("a-popover");return r(),F("div",le,[p.insetList?(r(),F("div",ue,[E("span",ce,$(t.$t("SHEET.VIEW.filters")),1),b(_,{text:t.$t("BUTTONS.add"),"text-color":"var(--grey-500)","type-text":"",class:"!mr-0",onClick:e[1]||(e[1]=i=>n.value=!0)},{preffix:C(()=>[b(v,{class:"mr-1",size:"14px",type:"mdi",color:"var(--grey-500)",path:a(G)},null,8,["path"])]),_:1},8,["text"])])):(r(),w(s,Z(q({key:0},{onDragOver:O,onDragLeave:j,onDrop:z})),{default:C(()=>[b(l,{hover:a(f),onClick:e[0]||(e[0]=i=>n.value=!0)},null,8,["hover"])]),_:1},16)),E("div",{class:te(["flex flex-col",{"flex justify-center items-center":a(h),"min-h-[88px] max-h-[225px] overflow-x-auto sm-border-all p-[11px]":p.insetList}])},[a(h)?(r(),F("span",me,$(t.$t("SHEET.VIEW.no_created_filter")),1)):T("",!0),(r(!0),F(K,null,Q(a(o),(i,H)=>(r(),w(x,{key:`filter-chip-${H}`,text:i.dimension.name,icon:a(X),onClick:P=>M(i),onClose:P=>N(i.dimension.id),onContextmenu:e[2]||(e[2]=Y(()=>{},["prevent","stop"]))},null,8,["text","icon","onClick","onClose"]))),128)),a(n)?(r(),w(m,{key:1,visible:a(n),"onUpdate:visible":e[4]||(e[4]=i=>ee(n)?n.value=i:null),"overlay-class-name":"w-[320px]",trigger:"click"},{content:C(()=>[b(y,{ref_key:"filterSelector",ref:c,chip:p.index,onCancel:e[3]||(e[3]=i=>n.value=!1),onSubmit:S},null,8,["chip"])]),_:1},8,["visible"])):T("",!0)],2)])}}});export{be as _};

import{f as Lt,r as I,H as ut,b as f,D as V,e as p,k as D,M as E,J as M,I as B,u as L,o as y,C as it,ar as j,t as dt,l as Kt,P as Rt,N as Wt,aT as Pt,ax as zt,at as jt,m as ft,x as Ut,a as qt}from"./entry.102678be.js";import{a as Ft,u as Jt}from"./index.d52a6416.js";import{D as yt,S as mt,u as Ot}from"./DataEntry.class.85823036.js";/* empty css                           */import"./index.3105222b.js";const Gt=["id"],Qt={class:"headers-parent"},Xt=["onContextmenu"],Yt=["data-cy"],Zt={class:"mr-[15px] pl-[10px] cell-class truncate"},xt={ref:"scrollDiv",class:"scroll-div"},te={class:"virtual-content"},ee=["data-cy"],ne=["data-cy","onMouseenter","onMousedown","onClick","onContextmenu"],oe=["onClick"],se=["id","type","onBlur","onInput","onKeypress"],ae={key:2,class:"content-cell"},re={key:3,class:"w-0"},le=["onMousedown"],ce=Lt({__name:"SmartSheet",props:{id:{type:Number,default:()=>1},items:{type:Array,default:()=>[]},colWidths:{type:Array,default:()=>[]},nestedHeaders:{type:Array,default:()=>[]},cellMinWidth:{type:Number,default:87},rowHeight:{type:Number,default:30},enableDataEntry:{type:Boolean,default:!0},hasDraftAlert:{type:Boolean,default:!1},addLine:{type:Boolean,default:!1},dataKeyName:{type:Object,required:!1,default:()=>({contentViews:"",contentType:"dataType"})}},emits:["add-row","data-entry","context-menu","context-header","load-data"],setup(b,{expose:pt,emit:g}){const d=b;pt({focusCell:At,getActiveCell:It});let r=new yt,c=new mt;const h=I(""),T=I(null),U=I(""),_=I(1);Ft(T,()=>g("load-data"),{distance:20}),Jt(T,"mouseup",()=>{Et()});const vt=ut(()=>{var e;const t=(e=d.cellMinWidth)!=null?e:0;return d.colWidths.map(l=>t>l?t:l)}),wt=ut(()=>({"--rowHeight":`${d.rowHeight}px`}));function ht(t,e){g("context-menu",`${t}-${e}`)}function q(t){return d.dataKeyName.contentViews?t[d.dataKeyName.contentViews]:t.content}function F(t,e=0){return{width:Math.max(vt.value[t]-e,0)+"px"}}function St(t,e,l=0){const n=e;if(c!=null&&c.active&&t.buttons){const s=r.selection,o=l;r.active||J(n,o,r.selection,r.rootSelection),J(n,o,c,s),$()}}function J(t,e,l,n){var s,o,u,a,i,m,v,w;l.colAnd=Math.max(t,(s=n.colStart)!=null?s:0,(o=n.colAnd)!=null?o:0),l.rowAnd=Math.max(e,(u=n.rowStart)!=null?u:0,(a=n.rowAnd)!=null?a:0),l.colStart=Math.min(t,(i=n.colStart)!=null?i:0,(m=n.colAnd)!=null?m:0),l.rowStart=Math.min(e,(v=n.rowStart)!=null?v:0,(w=n.rowAnd)!=null?w:0)}function O(t,e,l=c){var o,u,a,i;const n=l;return((o=n.colAnd)!=null?o:0)>=t&&((u=n.colStart)!=null?u:0)<=t&&((a=n.rowAnd)!=null?a:0)>=e&&((i=n.rowStart)!=null?i:0)<=e}function $t(t,e){let l={};const n=t,s=e,u=`${s}-${t}`,a=r.selection,i=c.active&&O(n,s),m=O(n,s,a);return l={dataEntry:!r.multiSelect&&r.active===u,active:r.active===u,left:i&&c.colStart===n||m&&a.colStart===n,top:i&&c.rowStart===s||m&&a.rowStart===s,right:i&&c.colAnd===n||m&&a.colAnd===n,bottom:i&&c.rowAnd===s||m&&a.rowAnd===s,betweenActive:a.active&&m},_.value&&l}function At(t,e){W(t,e),r.input=!0,K(e,t);const l=T.value;l&&(l.scrollTop=l.scrollHeight)}function K(t,e){if(d.enableDataEntry&&r.input){const l=`${e}-${t}`;r.active=l,h.value=r[l]=C(e,t),$(),setTimeout(()=>{var n;(n=document.getElementById(`dataEntry-${e}-${t}`))==null||n.focus()})}}function bt(t,e){const l=e,n=r.selection,s=d.nestedHeaders[t];return!(s!=null&&s.referencingMe)&&!(s!=null&&s.isNative)&&_.value&&n.rowAnd===l&&n.colAnd===t}function G(t){return q(d.items[t])}function C(t,e,l=!0){var u;const n=l&&gt(e,t),s=G(t)[e],o=(u=s==null?void 0:s.metricValue)!=null?u:s;return _.value&&(n||o)}function gt(t,e){return r[`${e}-${t}`]}function _t(t,e){r.multiSelect=!0,r.selection={...c},r[`${t}-${e}`]=G(t)[e],r.active||(r.active=!0)}function R(t,e){var n,s,o,u;const l=e;return Ot()[(u=(o=(n=d.nestedHeaders[t])==null?void 0:n.dimensionAttributeType)!=null?o:(s=d.nestedHeaders[t])==null?void 0:s.dataType)!=null?u:""]&&_.value&&!r.multiSelect&&r.active===`${l}-${t}`}function Ct(t,e,l){const s=`${e}-${t}`;r[s]===C(e,t,!1)?delete r[s]:Q({[s]:r[s]}),r.active=null,r.input=!1,$(),X(l)}function kt(t){return Y(t)==="number"&&h.value===""?null:h.value}function Dt(t,e){r[`${e}-${t}`]=kt(t)}function W(t,e){var m,v,w,S;const l=t,n=e,s=e,o=t,u=r.selection,a=d.nestedHeaders[n];e>=((m=u.colStart)!=null?m:-1)&&e<=((v=u.colAnd)!=null?v:-1)&&t>=((w=u.rowStart)!=null?w:-1)&&t<=((S=u.rowAnd)!=null?S:-1)&&!a.isNative&&!a.referencingMe&&(r.input=!0),c.active=`${l}-${n}`,c.colStart=s,c.rowStart=o,c.colAnd=s,c.rowAnd=o,r.selection={...c},r.rootSelection={...c},$()}function $(){_.value++}function Et(){r.multiSelect&&c!==r.selection&&(Tt(),r.selection={...c},r.active=null,r.multiSelect=!1,$())}function Mt(){var l,n,s,o;const t=[],e=r.selection;if(e.active)for(let u=(l=e.rowStart)!=null?l:0;u<=((n=e.rowAnd)!=null?n:0);u++){const a=[];for(let i=(s=e.colStart)!=null?s:0;i<=((o=e.colAnd)!=null?o:0);i++)a.push(C(u,i));t.push(a)}return t}function Tt(){var Z,x,tt,et,nt,ot,st,at,rt;const t=Mt(),e=r.selection,l=Number(r.rootSelection.colStart),n=e.colStart===c.colStart,s=e.rowStart===c.rowStart,o=t.length,u=t[0].length,a=(((Z=c.rowAnd)!=null?Z:0)-((x=c.rowStart)!=null?x:0)+1)%o,i=(((tt=c.colAnd)!=null?tt:0)-((et=c.colStart)!=null?et:0)+1)%u,m=s?0:a?o-a:0,v=n?0:i?u-i:0,w={};let S=m,A=v;for(let N=(nt=c.rowStart)!=null?nt:0;N<=((ot=c.rowAnd)!=null?ot:0);N++){for(let k=(st=c.colStart)!=null?st:0;k<=((at=c.colAnd)!=null?at:0);k++){const lt=d.nestedHeaders[l+A],Bt=lt.dimensionAttributeType,H=d.nestedHeaders[k];if(!H.isNative&&!H.referencingMe){const P=(rt=H.dimensionAttributeType)!=null?rt:"",z=t[S][A];if(H.id===lt.id||P===Bt&&!(P.includes("Link")||P.includes("Choice"))){const ct=`${N}-${k}`;z!==C(N,k,!1)&&(r[ct]=z),w[ct]=z}}A++,u===A&&(A=0)}S++,A=v,o===S&&(S=0)}Q(w)}function Q(t){g("data-entry",t)}function Nt(){var t;return{bottom:`-${((t=d.rowHeight)!=null?t:30)/2-1}px`,right:`${2}px`}}function X(t){const e=t.relatedTarget;(!t.relatedTarget||!e.closest(".virtual-content"))&&(r=new yt,c=new mt,$())}function Y(t){return d.nestedHeaders[t][d.dataKeyName.contentType]==="Number"?"number":"text"}function Ht(t,e){g("context-header",{item:t,idx:e})}function It(){return r.selection}function Vt(t,e){var n;(n=document.activeElement)==null||n.blur();const l=t+1;d.items[l]&&W(l,e),r.input=!0,K(e,l)}return(t,e)=>{const l=Ut;return y(),f("div",{id:`SmartTable${b.id}`,ref_key:"smartTableDiv",ref:T,class:"table-class noselect relative",style:B(L(wt))},[V(t.$slots,"headerParent",{},()=>[p("div",Qt,[(y(),f(D,null,E(["normal"],n=>p("div",{key:n,class:it([{[n]:!0},"header-row !w-max"])},[(y(!0),f(D,null,E(b.nestedHeaders,(s,o)=>(y(),f("div",{key:o,style:B(F(o)),class:"border h-full",onContextmenu:j(u=>Ht(s,o),["stop","prevent"])},[p("div",{class:"w-full h-full header-flex","data-cy":`header-col-${o}`},[p("div",Zt,[V(t.$slots,"header",{col:o,item:s},()=>[p("span",null,dt(s),1)],!0)])],8,Yt)],44,Xt))),128))],2)),64))])],!0),p("div",xt,[p("div",te,[(y(),f(D,null,E(["normal"],n=>p("div",{key:n},[(y(!0),f(D,null,E(d.items,(s,o)=>(y(),f("div",{key:o,"data-cy":`line-${o}`,class:"row-content"},[(y(!0),f(D,null,E(q(s),(u,a)=>(y(),f("div",{key:a,tabIndex:"0",class:it(["col-content",$t(a,o)]),"data-cy":`line-${o}-col-${a}`,style:B(F(a)),onMouseenter:i=>St(i,a,o),onMousedown:i=>W(o,a),onClick:i=>K(a,o),onContextmenu:j(i=>ht(o,a),["stop","prevent"]),onBlur:X},[b.hasDraftAlert&&L(U)!==`${a}-${o}`&&u===null&&!s.internalId?(y(),f("div",{key:0,class:"cell--draft z-[2] w-full shrink-0 flex items-center justify-end",onClick:i=>U.value=`${a}-${o}`},[Kt(l,{class:"mr-2",size:"15",color:"grey",type:"mdi",path:L(Rt)},null,8,["path"])],8,oe)):M("",!0),R(a,o)?Wt((y(),f("input",{key:1,id:`dataEntry-${o}-${a}`,"onUpdate:modelValue":e[0]||(e[0]=i=>zt(h)?h.value=i:null),type:Y(a),class:"content-cell",onBlur:i=>Ct(a,o,i),onInput:i=>Dt(a,o),onKeypress:jt(i=>Vt(o,a),["enter"])},null,40,se)),[[Pt,L(h)]]):M("",!0),R(a,o)?M("",!0):(y(),f("div",ae,[V(t.$slots,"default",{row:o,col:a,item:u},()=>[ft(dt(C(o,a)),1)],!0)])),bt(a,o)&&!R(a,o)?(y(),f("div",re,[p("div",{class:"entry-btn",style:B(Nt()),onMousedown:j(i=>_t(o,a),["stop"])},null,44,le)])):M("",!0)],46,ne))),128))],8,ee))),128))])),64))])],512),b.addLine?(y(),f("div",{key:0,class:"row-content footer-class",onClick:e[1]||(e[1]=n=>g("add-row"))},[V(t.$slots,"footer",{},()=>[ft(" + ")],!0)])):M("",!0)],12,Gt)}}}),me=qt(ce,[["__scopeId","data-v-7e5fde3f"]]);export{me as default};

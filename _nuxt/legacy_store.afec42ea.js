import{u as d}from"./useLegacyService.c9b3bbf8.js";import{a8 as u,a9 as S,aa as h,ab as m,s as a}from"./entry.102678be.js";import{u as l}from"./useHeadSettings.f1985dcc.js";var f="[object Number]";function L(e){return typeof e=="number"||u(e)&&S(e)==f}function M(e){return L(e)&&e!=+e}const v=h("LegacyStore",{state:()=>({moduleList:[],screenList:[],modulesScreenList:[],selectedModule:null,selectedScreenId:0,deleteModuleRef:null}),actions:{async fetchModules(){const{data:e,error:t}=await d().getModuleList();if(t)throw this.moduleList=[],t;return this.moduleList=e,this.moduleList},async fetchList(){var e,t;if(this.selectedModule){if(M((e=this.selectedModule)==null?void 0:e.id))return this.screenList=[],this.screenList;if(String((t=this.selectedModule)==null?void 0:t.id)==="Nativas")return this.screenList=[],this.screenList;const{data:s,error:n}=await d().getScreenList(this.selectedModule.id);if(n)throw this.screenList=[],n;return this.screenList=s,this.screenList}},async fetchAll(){const{data:e,error:t}=await d().getAll();if(t)throw this.modulesScreenList=[],t;return this.modulesScreenList=e,this.modulesScreenList},getDataFromQuery(){const{params:e,query:t}=m();if(e.moduleId){const s=this.moduleList.find(n=>n.id===Number(e.moduleId));this.setSelectedModule(s!=null?s:{id:Number(e.moduleId),name:""}),t.screenId&&this.setSelectedScreen(Number(t.screenId))}else this.selectedScreenId<0&&this.setSelectedModule(null)},async saveScreen(e){const{data:t,error:s}=await d().saveScreen(e);if(s)throw a(s.message),s;return this.screenList.push(t),t},async editScreenName(e){const{data:t,error:s}=await d().updateScreenName(e);if(s)throw a(s.message),s;{const n=this.screenList.findIndex(i=>i.id===t.id);return this.screenList[n].name=t.name,this.modulesScreenList.forEach(i=>{const r=i.activatedScreens.findIndex(c=>c.id===t.id),o=i.inactivatedScreens.findIndex(c=>c.id===t.id);if(r>-1){const c=i.activatedScreens[r];c.name=t.name,i.activatedScreens[r]=c}else if(o>-1){const c=i.inactivatedScreens[o];c.name=t.name,i.inactivatedScreens[o]=c}}),t}},async setSelectedModule(e){this.selectedModule=e,await this.fetchList()},getSelectedScreenHeadTitle(){var n,i;const e="-",t=String(this.selectedScreenId).charAt(0)===e;let s;if(t){const r=String(this.selectedScreenId);s=l().getNativeNames(r)}else s=(i=(n=this.getSelectedScreen)==null?void 0:n.name)!=null?i:"";l().setHeadTitle(s)},setSelectedScreen(e){this.selectedModule&&(this.selectedScreenId=e)},clearSelectedScreen(){this.selectedScreenId=0},getScreenNameById(e){const t=this.screenList.find(s=>s.id===e);return t?t.name:""},async createModule(e){const t={editMode:!0,name:e},{data:s,error:n}=await d().createModule(t);if(s){const i={id:s.id,name:s.name,activatedScreens:[],inactivatedScreens:[{id:s.homeScreen.id,name:s.homeScreen.name,isMobile:!1}]};this.moduleList.unshift(i),this.modulesScreenList.unshift(i),this.setSelectedModule(s)}else{if(n)throw a(n.message),n;a("TOAST.failed_create_folder")}},async renameModule(e,t,s){const n={id:e,name:t,businessUserDataEntry:!0,businessUserScreenSearch:!0,homeScreen:this.modulesScreenList[s].inactivatedScreens[0],homeScreenId:this.modulesScreenList[s].inactivatedScreens[0].id,initialScreens:[]},{data:i,error:r}=await d().renameModule(n);if(i)this.moduleList[s].name=t,this.modulesScreenList[s].name=t;else{if(r)throw a(r.message),r;a("TOAST.fail_to_rename_folder")}},async deleteModule(e){const{error:t}=await d().deleteModule(e);if(t)throw a(t.message),t;{const s=this.moduleList.findIndex(i=>i.id===e),n=this.modulesScreenList.findIndex(i=>i.id===e);s!==-1&&this.moduleList.splice(s,1),n!==-1&&this.modulesScreenList.splice(n,1)}}},getters:{getSelectedScreen(){const e=this.modulesScreenList.find(t=>{var s;return t.id===((s=this.selectedModule)==null?void 0:s.id)});if(e)return[...e.activatedScreens,...e.inactivatedScreens].find(t=>t.id===this.selectedScreenId)}}});export{M as i,v as u};

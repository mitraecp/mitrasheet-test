import{r as u,H as q,f as z,E as H,v as x,o as r,c as R,w as D,e as n,l as v,u as s,b as c,t as _,C as E,J as k,M as A,ek as J,k as I,ax as N,m as V,s as K,x as Q}from"./entry.102678be.js";import{_ as W}from"./MButton.vue.eb72e6c7.js";/* empty css                    */import{u as X}from"./dataset_store.f318df7c.js";import{u as O}from"./dimension_store.1aca34b5.js";import{r as Y}from"./useFormRules.a113b67d.js";function Z(){function l(){const o=u({name:""});return{dimensionForm:o,resetForm:()=>{o.value={name:""}}}}function h(){const o=u({name:"",datasetDimensions:[]}),m=u(!1),f=()=>{o.value={name:"",datasetDimensions:[]}},y=u(""),g=q(()=>{var d;return(d=w.value)==null?void 0:d.filter(b=>b.label.toLowerCase().includes(y.value.toLowerCase()))}),w=u([]),a=(d,b)=>b.label.toLowerCase().includes(d.toLowerCase());async function C(){m.value=!0,await O().fetchDimensions(),w.value=O().dimensions.map(d=>({label:d.name,value:d.id})),m.value=!1}return{datasetForm:o,loading:m,resetForm:f,datasetDimensions:w,filterOption:a,fillDatasetDimensionOptions:C,filterDatasetDimensions:g,datasetDimensionSearchTerm:y}}return{dimensionCreator:l,datasetCreator:h}}const ee=""+new URL("dimension_overlay.76862d3e.svg",import.meta.url).href,ae={class:"max-h-[280px] overflow-y-auto"},te={key:0,class:"flex justify-between"},se={class:"truncate w-[120px]"},ne=n("img",{class:"-mt-2 w-[20px]",src:ee},null,-1),oe={class:"ml-1"},ie={class:"flex flex-col"},le={class:"flex flex-col mt-3 max-h-[300px] overflow-y-auto"},re=["onClick"],de={key:0,class:"cursor-pointer w-fit"},me={key:0,class:"flex justify-end"},ce={key:0,class:"modal-footer"},he=z({__name:"DatasetEditor",props:{modalChild:{type:Boolean,default:!1},editor:{type:Boolean,default:!1},selectedDataset:{type:Object,required:!1,default:()=>({datasetDimensionViews:[]})}},emits:["saved"],setup(l,{emit:h}){const o=l,m=u(!1),f=u(!1),y=u(),g=X(),w=t=>{a.value.datasetDimensions.splice(t,1)},{datasetForm:a,resetForm:C,fillDatasetDimensionOptions:d,filterDatasetDimensions:b,datasetDimensionSearchTerm:B}=Z().datasetCreator();H(()=>{var t,i;a.value.name=(t=o.selectedDataset)==null?void 0:t.name,(i=o.selectedDataset)!=null&&i.datasetDimensionViews&&(a.value.datasetDimensions=o.selectedDataset.datasetDimensionViews.map(p=>{var L;return{name:p.dimensionName,alias:(L=p.alias)!=null?L:p.dimensionName,dimensionId:p.id}}))}),d();const S=async()=>{if(!a.value.datasetDimensions.length)K("TOAST.add_one_dimension_dataset");else{f.value=!0;try{await g.saveDataset({name:a.value.name.trim(),datasetDimensions:a.value.datasetDimensions}),C(),h("saved")}catch{}f.value=!1}},T=async()=>{var t;if(a.value.name===o.selectedDataset.name)C(),h("saved");else{(t=y.value)==null||t.validateFields(),f.value=!0;try{const{dataset:i}=await g.editDataset({id:o.selectedDataset.id,name:a.value.name});C(),h("saved",i)}catch{}f.value=!1}};return(t,i)=>{const p=x("a-input"),L=x("a-form-item"),G=Q,j=x("a-input-search"),P=x("a-popover"),F=W,M=x("a-form");return r(),R(M,{ref_key:"formRef",ref:y,model:s(a),"data-cy":"dataset-form",name:"form-new-dataset",autocomplete:"off",onFinish:S},{default:D(()=>[n("div",{class:E({"modal-form-body":l.modalChild})},[v(L,{class:"my-1",name:"name",rules:[s(Y)]},{default:D(()=>[v(p,{value:s(a).name,"onUpdate:value":i[0]||(i[0]=e=>s(a).name=e),class:"rounded-md mb-2",placeholder:t.$t("GLOBAL.name"),"data-cy":"input-name"},null,8,["value","placeholder"])]),_:1},8,["rules"]),n("div",ae,[s(a).datasetDimensions.length?(r(),c("div",te,[n("div",null,[n("span",null,_(t.$t("NATIVE.dimensions"))+":",1)]),n("div",{class:E(l.editor?"w-[165px]":"w-[178px]")},[n("span",null,_(t.$t("PAGEBUILDER.nickname"))+":",1)],2)])):k("",!0),(r(!0),c(I,null,A(s(a).datasetDimensions,(e,$)=>(r(),c("div",{key:`choosed-dim-${e.dimensionId}`,class:"flex pb-2 justify-between items-center my-2 pr-2 item-tile"},[n("div",se,[ne,n("span",oe,_(e.name),1)]),n("div",{class:E(["flex items-center",{"alias-wrapper":e.alias===e.name}])},[v(p,{value:e.alias,"onUpdate:value":U=>e.alias=U,disabled:l.editor,class:"rounded-md mx-2 w-[150px]"},null,8,["value","onUpdate:value","disabled"]),l.editor?k("",!0):(r(),R(G,{key:0,size:"15",type:"mdi",class:"cursor-pointer",path:s(J),onClick:U=>w($)},null,8,["path","onClick"]))],2)]))),128))]),n("div",ie,[v(P,{visible:s(m),"onUpdate:visible":i[2]||(i[2]=e=>N(m)?m.value=e:null),"overlay-class-name":"w-[200px]",trigger:"click",placement:"bottomRight","data-cy":"dataset-dimension-choices","arrow-point-at-center":"","destroy-popup-on-hide":""},{content:D(()=>[v(j,{value:s(B),"onUpdate:value":i[1]||(i[1]=e=>N(B)?B.value=e:null),placeholder:t.$t("PAGEBUILDER.search_options"),"data-cy":"dataset-dimensions-input"},null,8,["value","placeholder"]),n("div",le,[(r(!0),c(I,null,A(s(b),e=>(r(),c("span",{key:`dataset-dim-${e.id}`,class:"select-tile",onClick:$=>s(a).datasetDimensions.push({dimensionId:e.value,name:e.label,alias:e.label})},_(e.label),9,re))),128))])]),default:D(()=>[l.editor?k("",!0):(r(),c("span",de,"+ "+_(t.$t("PAGEBUILDER.dimension")),1))]),_:1},8,["visible"])]),l.modalChild?k("",!0):(r(),c("div",me,[v(F,{class:"w-[80px]",loading:s(f),"html-type":"submit","data-cy":"btn-submit"},{default:D(()=>[V(_(t.$t("GLOBAL.actions.create")),1)]),_:1},8,["loading"])]))],2),l.modalChild?(r(),c("div",ce,[v(F,{class:"ml-4 w-[150px]","data-cy":"btn-submit",onClick:T},{default:D(()=>[V(_(t.$t("PAGEBUILDER.save_editions")),1)]),_:1})])):k("",!0)]),_:1},8,["model"])}}});export{he as _,ee as a,Z as u};

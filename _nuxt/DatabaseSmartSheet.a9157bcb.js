import{f as jt,r as T,H as R,E as Ut,b as v,k as K,M as P,u as F,I as S,o as m,C,e as h,D as z,ar as Y,t as N,J as p,l as ht,P as Jt,N as Ot,aT as Yt,ax as Gt,at as Qt,m as Xt,ay as Zt,x as xt,a as te}from"./entry.102678be.js";import{a as ee,u as pt}from"./index.d52a6416.js";import{D as St,S as bt,u as ne}from"./DataEntry.class.85823036.js";/* empty css                           */import"./index.3105222b.js";const oe=["id"],ae={class:"header-row !w-max"},le=["onContextmenu"],se=["data-cy"],re={class:"cell-class flex items-end justify-end width-fill-available truncate"},ce=["data-cy"],ue=["data-cy","onMouseenter","onMousedown","onClick","onContextmenu"],ie=["onClick"],de=["id","type","onBlur","onInput","onKeypress"],fe={key:2,class:"content-cell"},ve={key:3,class:"w-0"},me=["onMousedown"],ye={key:1,class:"row-content",style:{height:"160px"}},we={key:0},he={key:0},pe={key:1},Se=jt({__name:"DatabaseSmartSheet",props:{id:{type:Number,default:()=>1},items:{type:Array,default:()=>[]},colWidths:{type:Array,default:()=>[]},nestedHeaders:{type:Array,default:()=>[]},cellMinWidth:{type:Number,default:87},rowHeight:{type:Number,default:30},rowCount:{type:Number,required:!0},enableDataEntry:{type:Boolean,default:!0},hasDraftAlert:{type:Boolean,default:!1},addLine:{type:Boolean,default:!1},addColumn:{type:Boolean,default:!1},fixed:{type:Number,required:!1,default:0},dataKeyName:{type:Object,required:!1,default:()=>({contentViews:"contents",contentType:"dataType"})}},emits:["add-row","data-entry","context-menu","context-header","load-data"],setup(w,{expose:$t,emit:M}){const d=w;$t({focusCell:tt,getActiveCell:Pt});let r=new St,u=new bt;const b=T(""),k=T(),$=T(),W=T(),G=T(""),H=T(1),gt=R(()=>d.items.map(t=>{const e=V(t),l=Q(e);return{...t,[d.dataKeyName.contentViews]:l}})),At=R(()=>[{header:Q(d.nestedHeaders),contents:gt.value},{header:d.nestedHeaders,contents:d.items}]);ee($,()=>M("load-data"),{distance:20}),pt(k,"mouseup",()=>{Vt()}),pt(k,"keydown",t=>{!r.active&&(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=65&&t.keyCode<=90||t.keyCode===32)&&(tt(Number(u.rowStart),Number(u.colStart)),b.value=t.key,nt(Number(u.colStart),Number(u.rowStart)))}),Ut(()=>{k.value&&($.value=k.value.querySelector(".contentScroll"),W.value=k.value.querySelector(".contentFixed"))});function Q(t){return t.slice(0,d.fixed)}const Ct=R(()=>{var e;const t=(e=d.cellMinWidth)!=null?e:0;return d.colWidths.map(l=>t>l?t:l)}),kt=R(()=>({"--rowHeight":`${d.rowHeight}px`}));function Dt(){W.value&&$.value&&(W.value.style.transform=`translateY(-${$.value.scrollTop}px)`,$.value.parentElement&&($.value.parentElement.scrollLeft=$.value.scrollLeft))}function Et(t,e){M("context-menu",`${t}-${e}`)}function V(t){return t[d.dataKeyName.contentViews]}function X(t){return{width:Math.max(Ct.value[t],0)+"px"}}function Tt(t,e,l=0){const a=e;if(u!=null&&u.active&&t.buttons){const n=r.selection,c=l;r.active||Z(a,c,r.selection,r.rootSelection),Z(a,c,u,n),D()}}function Z(t,e,l,a){var n,c,o,f,s,i,y,g;l.colAnd=Math.max(t,(n=a.colStart)!=null?n:0,(c=a.colAnd)!=null?c:0),l.rowAnd=Math.max(e,(o=a.rowStart)!=null?o:0,(f=a.rowAnd)!=null?f:0),l.colStart=Math.min(t,(s=a.colStart)!=null?s:0,(i=a.colAnd)!=null?i:0),l.rowStart=Math.min(e,(y=a.rowStart)!=null?y:0,(g=a.rowAnd)!=null?g:0)}function x(t,e,l=u){var c,o,f,s;const a=l;return((c=a.colAnd)!=null?c:0)>=t&&((o=a.colStart)!=null?o:0)<=t&&((f=a.rowAnd)!=null?f:0)>=e&&((s=a.rowStart)!=null?s:0)<=e}function Ft(t,e,l){let a={};const n=t,c=e,f=`${c}-${t}`,s=r.selection,i=u.active&&x(n,c),y=x(n,c,s);return a={border:l,dataEntry:!r.multiSelect&&r.active===f,active:r.active===f,left:i&&u.colStart===n||y&&s.colStart===n,top:i&&u.rowStart===c||y&&s.rowStart===c,right:i&&u.colAnd===n||y&&s.colAnd===n,bottom:i&&u.rowAnd===c||y&&s.rowAnd===c,betweenActive:s.active&&y},H.value&&a}function tt(t,e){U(t,e),r.input=!0,q(e,t);const l=$.value;l&&(l.scrollTop=l.scrollHeight)}function q(t,e){if(d.enableDataEntry&&r.input){const l=`${e}-${t}`;r.active=l,b.value=r[l]=I(e,t),D(),setTimeout(()=>{var a;(a=document.getElementById(`dataEntry-${e}-${t}`))==null||a.focus()})}}function Nt(t,e){const l=e,a=r.selection,n=d.nestedHeaders[t];return!(n!=null&&n.referencingMe)&&!(n!=null&&n.isNative)&&H.value&&a.rowAnd===l&&a.colAnd===t}function et(t){return V(d.items[t])}function I(t,e,l=!0){var o;const a=l&&Mt(e,t),n=et(t)[e],c=(o=n==null?void 0:n.metricValue)!=null?o:n;return H.value&&(a||c)}function Mt(t,e){return r[`${e}-${t}`]}function Ht(t,e){r.multiSelect=!0,r.selection={...u},r[`${t}-${e}`]=et(t)[e],r.active||(r.active=!0)}function j(t,e){var a,n,c,o;const l=e;return ne()[(o=(c=(a=d.nestedHeaders[t])==null?void 0:a.dimensionAttributeType)!=null?c:(n=d.nestedHeaders[t])==null?void 0:n.dataType)!=null?o:""]&&H.value&&!r.multiSelect&&r.active===`${l}-${t}`}function It(t,e,l){const n=`${e}-${t}`;r[n]===I(e,t,!1)?delete r[n]:ot({[n]:r[n]}),r.active=null,r.input=!1,D(),at(l)}function Bt(t){return lt(t)==="number"&&b.value===""?null:b.value}function nt(t,e){r[`${e}-${t}`]=Bt(t)}function U(t,e){var i,y,g,A;const l=t,a=e,n=e,c=t,o=r.selection,f=d.nestedHeaders[a];e>=((i=o.colStart)!=null?i:-1)&&e<=((y=o.colAnd)!=null?y:-1)&&t>=((g=o.rowStart)!=null?g:-1)&&t<=((A=o.rowAnd)!=null?A:-1)&&!f.isNative&&!f.referencingMe&&(r.input=!0),u.active=`${l}-${a}`,u.colStart=n,u.rowStart=c,u.colAnd=n,u.rowAnd=c,r.selection={...u},r.rootSelection={...u},D()}function D(){H.value++}function Vt(){r.multiSelect&&u!==r.selection&&(Lt(),r.selection={...u},r.active=null,r.multiSelect=!1,D())}function _t(){var l,a,n,c;const t=[],e=r.selection;if(e.active)for(let o=(l=e.rowStart)!=null?l:0;o<=((a=e.rowAnd)!=null?a:0);o++){const f=[];for(let s=(n=e.colStart)!=null?n:0;s<=((c=e.colAnd)!=null?c:0);s++)f.push(I(o,s));t.push(f)}return t}function Lt(){var st,rt,ct,ut,it,dt,ft,vt,mt;const t=_t(),e=r.selection,l=Number(r.rootSelection.colStart),a=e.colStart===u.colStart,n=e.rowStart===u.rowStart,c=t.length,o=t[0].length,f=(((st=u.rowAnd)!=null?st:0)-((rt=u.rowStart)!=null?rt:0)+1)%c,s=(((ct=u.colAnd)!=null?ct:0)-((ut=u.colStart)!=null?ut:0)+1)%o,i=n?0:f?c-f:0,y=a?0:s?o-s:0,g={};let A=i,E=y;for(let _=(it=u.rowStart)!=null?it:0;_<=((dt=u.rowAnd)!=null?dt:0);_++){for(let B=(ft=u.colStart)!=null?ft:0;B<=((vt=u.colAnd)!=null?vt:0);B++){const yt=d.nestedHeaders[l+E],qt=yt.dimensionAttributeType,L=d.nestedHeaders[B];if(!L.isNative&&!L.referencingMe){const J=(mt=L.dimensionAttributeType)!=null?mt:"",O=t[A][E];if(L.id===yt.id||J===qt&&!(J.includes("Link")||J.includes("Choice"))){const wt=`${_}-${B}`;O!==I(_,B,!1)&&(r[wt]=O),g[wt]=O}}E++,o===E&&(E=0)}A++,E=y,c===A&&(A=0)}ot(g)}function ot(t){M("data-entry",t)}function Rt(){var t;return{bottom:`-${((t=d.rowHeight)!=null?t:30)/2}px`,right:`${3}px`}}function at(t){const e=t.relatedTarget;(!t.relatedTarget||!e.closest(".virtual-content"))&&(r=new St,u=new bt,D())}function lt(t){return d.nestedHeaders[t][d.dataKeyName.contentType]==="Number"?"number":"text"}function Kt(t,e){M("context-header",{item:t,idx:e})}function Pt(){return r.selection}function zt(t,e){var a;(a=document.activeElement)==null||a.blur();const l=t+1;d.items[l]&&U(l,e),r.input=!0,q(e,l)}function Wt(t){return{"overflow-hidden":t,"width-fill-available":t}}return(t,e)=>{const l=xt;return m(),v("div",{id:`SmartTable${w.id}`,ref_key:"smartTableDivParent",ref:k,class:"table-class noselect relative",style:S(F(kt))},[(m(!0),v(K,null,P(F(At),(a,n)=>(m(),v("div",{key:n,class:C(["flex flex-col border",Wt(n)]),style:S({zIndex:n?0:1})},[h("div",{class:C(["flex flex-col height-fill-available",{"overflow-hidden":n}])},[z(t.$slots,"headerParent",{},()=>[h("div",{class:"headers-parent",style:S({paddingRight:n?"10px":"0px"})},[h("div",ae,[(m(!0),v(K,null,P(a.header,(c,o)=>(m(),v("div",{key:o,class:"h-full"},[!n||o>=w.fixed?(m(),v("div",{key:0,style:S(X(o)),class:C(["h-full",{border:o!==a.header.length-1||!!n}]),onContextmenu:Y(f=>Kt(c,o),["stop","prevent"])},[h("div",{class:"w-full h-full header-flex","data-cy":`header-col-${o}`},[h("div",re,[z(t.$slots,"header",{col:o,item:c},()=>[h("span",null,N(c),1)],!0)])],8,se)],46,le)):p("",!0)]))),128))])],4)],!0),h("div",{class:C(["scroll-div",{contentScroll:n,contentFixed:!n}]),style:S({overflow:n?"auto":"",backgroundColor:n?"#F8F9FD":"#FFFFFF"}),onScroll:Dt},[h("div",{class:"virtual-content",style:S({marginRight:n&&w.addColumn?"80px":""})},[(m(!0),v(K,null,P(a.contents,(c,o)=>(m(),v("div",{key:o,"data-cy":`line-${o}`,class:"row-content"},[(m(!0),v(K,null,P(V(c),(f,s)=>(m(),v("div",{key:s},[!n||s>=w.fixed?(m(),v("div",{key:0,tabIndex:"0",class:C(["col-content",Ft(s,o,s!==V(c).length-1||!!n)]),"data-cy":`line-${o}-col-${s}`,style:S(X(s)),onMouseenter:i=>Tt(i,s,o),onMousedown:i=>U(o,s),onClick:i=>q(s,o),onContextmenu:Y(i=>Et(o,s),["stop","prevent"]),onBlur:at},[w.hasDraftAlert&&F(G)!==`${s}-${o}`&&f===null&&!c.internalId?(m(),v("div",{key:0,class:"cell--draft z-[2] w-full shrink-0 flex items-center justify-end",onClick:i=>G.value=`${s}-${o}`},[ht(l,{class:"mr-2",size:"15",color:"grey",type:"mdi",path:F(Jt)},null,8,["path"])],8,ie)):p("",!0),j(s,o)?Ot((m(),v("input",{key:1,id:`dataEntry-${o}-${s}`,"onUpdate:modelValue":e[0]||(e[0]=i=>Gt(b)?b.value=i:null),type:lt(s),class:"content-cell",onBlur:i=>It(s,o,i),onInput:i=>nt(s,o),onKeypress:Qt(i=>zt(o,s),["enter"])},null,40,de)),[[Yt,F(b)]]):p("",!0),j(s,o)?p("",!0):(m(),v("div",fe,[z(t.$slots,"default",{row:o,col:s,item:f},()=>[Xt(N(I(o,s)),1)],!0)])),Nt(s,o)&&!j(s,o)?(m(),v("div",ve,[h("div",{class:"entry-btn",style:S(Rt()),onMousedown:Y(i=>Ht(o,s),["stop"])},null,44,me)])):p("",!0)],46,ue)):p("",!0)]))),128))],8,ce))),128)),w.addLine&&a.contents.length>=w.rowCount?(m(),v("div",{key:0,class:"row-content",onClick:e[1]||(e[1]=c=>M("add-row"))},[h("div",{class:C(["col-content w-full",{border:n&&d.nestedHeaders.length>2}])},[!n&&w.addLine?z(t.$slots,"footer",{key:0},()=>[ht(l,{class:"ml-2",size:"15",color:"#1B2139",type:"mdi",path:F(Zt)},null,8,["path"])],!0):p("",!0)],2)])):p("",!0),a.contents.length>=w.rowCount?(m(),v("div",ye,[h("div",{class:"w-full h-full",style:S({backgroundColor:n?"#F8F9FD":"#FFFFFF"})},null,4)])):p("",!0)],4)],38)],2),h("div",{class:C(["flex items-center min-h-[32px] border-top bg-[white]",{sticky:!n,"bottom-0":!n}])},[n?p("",!0):(m(),v("span",we,[w.rowCount===1?(m(),v("span",he,N(w.rowCount)+" "+N(t.$t("DATABASE.record")),1)):(m(),v("span",pe,N(w.rowCount)+" "+N(t.$t("DATABASE.records")),1))]))],2)],6))),128))],12,oe)}}}),ke=te(Se,[["__scopeId","data-v-bad0247f"]]);export{ke as default};

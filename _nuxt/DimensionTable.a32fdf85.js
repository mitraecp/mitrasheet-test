import{f as Be,j as Re,r as d,H as P,aB as W,b as A,m as le,t as h,l as g,u as n,J as E,c as O,w as D,an as $e,ax as Y,C as Ve,aC as je,s as B,x as Fe,v as re,o as c,ah as Ue,e as C,aD as Pe,ay as ue,au as We,av as ze,y as He,z as Ge,a as qe}from"./entry.102678be.js";import Je from"./TableAttributeContextMenu.c1ad8a44.js";import{_ as Ke}from"./TableDynamicCell.vue.a471fd36.js";import{_ as Qe}from"./MButton.vue.eb72e6c7.js";/* empty css                    */import{u as Xe}from"./useDataTypeIcons.d26d6eae.js";import{u as Ye,a as Ze}from"./useAttributeTypes.0411c883.js";import{a as et,c as Z}from"./useLegacyService.c9b3bbf8.js";import{u as tt}from"./dimension_store.1aca34b5.js";import{u as nt}from"./index.d52a6416.js";import{u as it}from"./DataEntry.class.85823036.js";import ot from"./SmartSheet.02ade0c8.js";import st from"./TableAttributeMenu.3f27ab4e.js";import at from"./DatabaseSmartSheet.a9157bcb.js";import{T as de}from"./table_constants.06ca38ff.js";/* empty css                           */import"./TableCheckbox.vue.071e61a3.js";import"./TableDatePicker.vue.a1333c1a.js";import"./TableAutoComplete.d2339888.js";import"./index.3105222b.js";import"./TableLinkRecord.6de8f04c.js";import"./CollaboratorAvatar.vue.dd08577c.js";import"./TableComponentsMenu.b916b5cb.js";import"./useFormRules.a113b67d.js";const lt=S=>(He("data-v-9f4d6ec1"),S=S(),Ge(),S),rt={key:0,class:"mb-5 font-bold flex justify-between items-center mx-2 ml-3"},ut={key:1,class:"w-full h-full bg-grey-300 absolute z-20"},dt=lt(()=>C("div",{class:"bg-grey-200 h-full w-full animate-pulse"},null,-1)),ct=[dt],mt=["title"],pt={class:"flex items-center justify-center mr-[6px]"},ft={class:"truncate"},vt={key:0},bt={key:1},yt={key:0,class:"flex flex-col justify-center ml-auto"},At=["title","onClick"],_t={key:1,class:"px-2"},ht={key:2,class:"flex items-end font-sans hover:cursor-pointer"},Ct=["onClick"],wt={class:"flex items-center justify-center hover:cursor-pointer pl-[10px]","data-cy":"btn-add-row",title:"$t('DATABASE.add_row')"},gt={class:"title"},Tt={class:"att-title"},Dt={class:"table-att-menu flex items-center button-panel"},St=Be({__name:"DimensionTable",props:{loadOnCreated:{type:Boolean,default:!1},dimension:{type:Object,required:!0},displayName:{type:Boolean,default:!0},fixed:{type:Number,default:0}},emits:["update-view"],setup(S,{expose:ce,emit:me}){const m=S,pe=m.fixed?at:ot,fe=Xe(),{merge:M}=Re(),{enableAddRow:ve,linkRecordSaving:z}=Ye(m),x=et(),ee=tt(),R=d(!0),f=d([]),H=d(Array([])),l=d([]),G=d(W.SIMPLE_ROW_LIMIT),be=P(()=>M?l.value.slice(0,G.value):l.value),$=d(null),q=d(),k=d(!1),_=d(!1),te=d(0),V=d(0),I=d(!1),j=d(!1),ne=d("-"),{dimensionTypeList:ye,dimensionTypeListAsOptions:Ae}=Ze(),F=d(!0),L=d(!1),J=d(!1),_e=P(()=>{let e=p.value.dimensionAttributeType;return["SingleLinkDimension","MultiLinkDimension"].includes(p.value.dimensionAttributeType)&&(e="LinkDimension"),["SingleLinkToUser","MultiLinkToUser"].includes(p.value.dimensionAttributeType)&&(e="LinkToUser"),{...p.value,dimensionAttributeType:e}}),he=P(()=>p.value.dimensionAttributeType.startsWith("Multi")),p=d({id:0,name:"",isNative:!1,dimensionAttributeType:"SingleLineText",options:[]});m.loadOnCreated&&U({displayLoadingFrame:!0}),nt(document,"keydown",e=>{e.ctrlKey&&(e.key==="c"&&Oe(),e.key==="v"&&Ee())});const T=P(()=>R.value?f.value.concat({id:0,name:"+",isNative:!1,dimensionAttributeType:"Number",options:[]}):f.value);async function Ce(){const{content:e}=await x.postContentRow(m.dimension.id);e.dimensionContentAttributesView=Array(f.value.length).fill(null),l.value.push(e),V.value+=1,setTimeout(()=>{var t;return(t=$.value)==null?void 0:t.focusCell(l.value.length-1,0)})}async function we(e){var a;const{value:t,error:i}=await Z().postContentAttribute(e);i?B((a=i.message)!=null?a:"DIMENSIONS.attributes.add_attribute_error"):(K(!1),se(!1),l.value.forEach(s=>s.dimensionContentAttributesView.push(null)),H.value.push(de.COL_WIDTH),f.value.push(t),ee.fetchDimensions())}async function ge(e,t,i){var v;const a=f.value[i].dimensionAttributeType==="MultiLinkDimension";z.value=!0;const s=M?"id":"dimensionAttributeId",y={id:{id:m.dimension.id,mergeDimensionAttributeType:"DIMENSION_MAIN"},dimensionId:m.dimension.id,dimensionContentForms:[{dimensionContentAttributeForms:a&&M?e.map(b=>({id:f.value[i].id,value:b})):[{[s]:f.value[i].id,value:e}],internalId:(v=l.value[t].internalId)!=null?v:0}]};l.value[t].dimensionContentAttributesView[i]=e;try{const{error:b,updateInfo:o}=await x.putDimensionContent(y);b?B(b.message):o.needsRefresh&&Te(o.dimensionContentAttributesView)}catch{}z.value=!1}async function ie(e){var a;const t={};for(const s in e){const y=s.split("-");if(y.length===2){const v=Number(y[0]),b=Number(y[1]),o=e[s];l.value[v].dimensionContentAttributesView[b]=je(o);const r=(a=l.value[v].internalId)!=null?a:0;t[r]||(t[r]={internalId:r,dimensionContentAttributeForms:[]});const u=M?"id":"dimensionAttributeId";t[r].dimensionContentAttributeForms.push({[u]:f.value[b].id,value:o})}}const i=[];for(const s in t)i.push(t[s]);try{const{error:s}=await x.putDimensionContent({id:{id:m.dimension.id,mergeDimensionAttributeType:"DIMENSION_MAIN"},dimensionId:m.dimension.id,dimensionContentForms:i});s&&B(s.message)}catch{}}function Te(e){e.forEach(t=>{const i=T.value.findIndex(s=>s.id===t.affectedDimensionContentAttribute[0].dimensionAttributeId),a=l.value.findIndex(s=>s.internalId===t.internalId);a>-1&&i>-1&&(l.value[a].dimensionContentAttributesView[i]=t.affectedDimensionContentAttribute[0].dimensionContentAttributesView)})}function De(e){se(!0),p.value=e}async function Se(){var e,t;if(q.value){const i=q.value.getDimensionAttributeObj(),{error:a}=await Z().putContentAttribute((e=i.id)!=null?e:0,i);a?B((t=a.message)!=null?t:"DIMENSIONS.attributes.change_type_attribute_error"):(U({displayLoadingFrame:!1}),oe())}}function oe(){_.value=!_.value}function K(e){k.value=e}function se(e){F.value=e}function Q(e,t){e.isNative||(te.value=t,e.id||(e.name=""),p.value=e,F.value=!!e.id,K(!0))}async function xe(e){const t=l.value[e].internalId;if(t){const{error:i}=await x.deleteContentRow(m.dimension.id,t);I.value=!1,i||(l.value.splice(e,1),V.value=l.value.length)}}function ke(e){ne.value=e,I.value=!0}async function Ie(){if(M)G.value=G.value+W.SIMPLE_ROW_LIMIT;else{const{dimensionDataView:e}=await x.getDimensionContent(m.dimension.id,{query:{limit:W.SIMPLE_ROW_LIMIT,offSet:l.value.length}});l.value=[...l.value,...e.contents]}}async function U({displayLoadingFrame:e,dimensionId:t}){e&&(j.value=!0);const{dimensionDataView:i}=await x.getDimensionContent(t!=null?t:m.dimension.id,{query:{limit:W.SIMPLE_ROW_LIMIT,offSet:0}});f.value=i.headers,H.value=Array(f.value.length).fill(de.COL_WIDTH),l.value=i.contents,V.value=i.rowCount,j.value=!1}function Le(e){({toggleEditAttributeModal:oe,openDeleteAttributeModal:Me})[e]()}function Me(){K(!1),L.value=!0}async function Ne(){var e;J.value=!0;try{const{error:t}=await Z().deleteContentAttribute(p.value);if(!t)L.value=!1,U({displayLoadingFrame:!1}),ee.fetchDimensions();else throw t}catch(t){B((e=t.message)!=null?e:"DIMENSIONS.attributes.delete_attribute_error")}J.value=!1}function Ee(){var t;const e=(t=$.value)==null?void 0:t.getActiveCell();navigator.clipboard.readText().then(i=>{const a=i.split(`\r
`).map(v=>v.split("	")),s={};let y=0;if(e&&e.rowStart&&e.colStart){const v=e.rowStart+a.length-1,b=e.colStart+a[0].length-1;for(let o=e.rowStart;o<=v;o++){let r=0;if(!l.value[o])break;for(let u=e.colStart;u<=b;u++){const N=T.value[u];if(!N)break;const w=N.dimensionAttributeType;if(w==="Number"||w==="SingleLineText"){const ae=a[y][r],X=w==="Number"?Number(ae):ae;(X||X===0)&&(s[`${o}-${u}`]=X)}r++}y++}ie(s)}})}function Oe(){var t;const e=(t=$.value)==null?void 0:t.getActiveCell();if(e&&e.rowAnd&&e.rowStart&&e.colAnd&&e.colStart){let i="";for(let a=e.rowStart;a<=e.rowAnd;a++){for(let s=e.colStart;s<=e.colAnd;s++)i=i+l.value[a].dimensionContentAttributesView[s],s!==e.colAnd&&(i=i+"	");a!==e.rowAnd&&(i=i+`\r
`)}navigator.clipboard.writeText(i)}}return ce({loadDimensionContent:U}),(e,t)=>{const i=Fe,a=Je,s=re("a-popover"),y=Ke,v=Qe,b=re("a-modal");return c(),A("div",{class:Ve(["bg-white flex flex-col overflow-hidden w-full relative",{"p-2":!n(j)}])},[m.displayName?(c(),A("div",rt,[le(h(m.dimension.name)+" ",1),g(i,{class:"cursor-pointer",color:"grey",type:"mdi",size:"18",path:n(Ue),onClick:t[0]||(t[0]=o=>me("update-view",o))},null,8,["path"])])):E("",!0),n(j)?(c(),A("div",ut,ct)):E("",!0),(c(),O($e(n(pe)),{ref_key:"supersheet",ref:$,items:n(be),"col-widths":n(H),"nested-headers":n(T),"add-line":n(ve),"add-column":n(R),"data-key-name":{contentViews:"dimensionContentAttributesView",contentType:"dimensionAttributeType"},fixed:S.fixed,"row-count":n(V),"row-height":32,onAddRow:Ce,onDataEntry:ie,onContextMenu:ke,onContextHeader:t[7]||(t[7]=o=>Q(o.item,o.idx)),onLoadData:Ie},{header:D(({item:o,col:r})=>[n(R)&&r!==n(f).length||!n(R)?(c(),A("div",{key:0,class:"flex items-center width-fill-available header mx-[10px] root",title:o.name},[C("div",pt,[g(i,{height:"15px",color:"var(--grey-600)",type:"mdi",path:n(fe)[o.dimensionAttributeType]},null,8,["path"])]),C("div",ft,[o.name==="Description"?(c(),A("div",vt,h(e.$t("DATABASE.description")),1)):(c(),A("div",bt,h(o.name),1))]),o.isNative?E("",!0):(c(),A("div",yt,[g(i,{class:"cursor-pointer ml-[6px]",color:"#8D95B3",type:"mdi",size:"18",path:n(Pe),onClick:u=>Q(o,r)},null,8,["path","onClick"])]))],8,mt)):(c(),A("div",{key:1,class:"root flex max-w-[80px] min-w-[80px] items-center justify-center font-sans hover:cursor-pointer","data-cy":"btn-add-column",title:e.$t("DATABASE.add_column"),onClick:u=>Q(o,r)},[g(i,{size:"16",color:"#313854",type:"mdi",path:n(ue)},null,8,["path"])],8,At)),n(te)===r?(c(),O(s,{key:2,visible:n(k),"onUpdate:visible":t[4]||(t[4]=u=>Y(k)?k.value=u:null),"overlay-class-name":n(p).id&&!n(_)?"w-[130px]":"w-[350px]",placement:r<3?"bottomLeft":"bottomRight",trigger:"click","arrow-point-at-center":"",onVisibleChange:t[5]||(t[5]=u=>_.value=!1)},{content:D(()=>[n(p).id&&!n(_)?(c(),O(a,{key:0,options:[{title:e.$t("GLOBAL.edit"),icon:n(We),action:"toggleEditAttributeModal",disabled:n(p).referencingMe},{title:e.$t("GLOBAL.delete"),icon:n(ze),action:"openDeleteAttributeModal"}],onSelected:Le},null,8,["options"])):(c(),O(st,{ref_key:"editAttributeMenuRef",ref:q,key:n(p).dimensionAttributeType,controller:n(F),"col-attributes":n(_)?n(_e):n(p),"type-options":n(Ae),"dimension-id":m.dimension.id,types:n(ye),"is-multiple":n(he),onAddAttribute:t[1]||(t[1]=u=>(n(_)?Se():we(u),k.value=!1)),onAddCol:De,onOnClose:t[2]||(t[2]=u=>n(_)?_.value=!1:k.value=!1),onOnBack:t[3]||(t[3]=u=>F.value=!1)},null,8,["controller","col-attributes","type-options","dimension-id","types","is-multiple"]))]),_:2},1032,["visible","overlay-class-name","placement"])):E("",!0)]),default:D(({item:o,col:r,row:u})=>{var N;return[n(it)()[(N=n(T)[r].dimensionAttributeType)!=null?N:""]?(c(),A("span",_t,h(o!==null&&n(T)[r].dimensionAttributeType==="Number"?Number(o).toFixed(n(T)[r].precision):o),1)):(c(),O(y,{key:0,"display-picture":"",content:o,header:n(T)[r],saving:n(z),onSetDataEntry:w=>ge(w,u,r)},null,8,["content","header","saving","onSetDataEntry"])),n(I)&&`${u}-${r}`===n(ne)?(c(),A("div",ht,[g(s,{visible:n(I),"onUpdate:visible":t[6]||(t[6]=w=>Y(I)?I.value=w:null),"overlay-class-name":"w-[100px]",trigger:"click",placement:"bottomLeft"},{content:D(()=>[C("div",{class:"cursor-pointer hover:bg-[#eaecf0]",onClick:w=>xe(u)},h(e.$t("GLOBAL.delete")),9,Ct)]),_:2},1032,["visible"])])):E("",!0)]}),footer:D(()=>[C("div",wt,[g(i,{size:"16",color:"#313854",type:"mdi",path:n(ue)},null,8,["path"])])]),_:1},40,["items","col-widths","nested-headers","add-line","add-column","fixed","row-count"])),g(b,{visible:n(L),"onUpdate:visible":t[9]||(t[9]=o=>Y(L)?L.value=o:null),"destroy-on-close":"",centered:"",closable:!1,footer:null},{default:D(()=>[C("div",gt,h(e.$t("DATABASE.sure_to_delete_attribute")),1),C("div",Tt,h(e.$t("DATABASE.action_cannot_undone")),1),C("div",Dt,[C("div",{class:"cancel cursor-pointer",onClick:t[8]||(t[8]=o=>L.value=!1)},h(e.$t("BUTTONS.cancel")),1),g(v,{loading:n(J),style:{"background-color":"#7839ee",color:"#fff"},class:"!w-[61px] !h-[33px] flex justify-center items-center","data-cy":"btn-submit",onClick:Ne},{default:D(()=>[le(h(e.$t("GLOBAL.delete")),1)]),_:1},8,["loading"])])]),_:1},8,["visible"])],2)}}}),Xt=qe(St,[["__scopeId","data-v-9f4d6ec1"]]);export{Xt as default};
